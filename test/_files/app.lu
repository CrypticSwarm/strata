use(link.contentType, "text/plain");
use(link.contentLength);

function xPosition(app, positionName) {
    positionName = positionName || "root";

    return function (env, callback) {
        app(env, function (status, headers, body) {
            if (!headers["X-Position"]) {
                headers["X-Position"] = positionName;
            }

            callback(status, headers, body);
        });
    }
}

use(xPosition, "root");

map("/path", function (app) {
    app.use(xPosition, "path");
    app.run(function (env, callback) {
        callback(200, {}, "Hello from /path!");
    });
});

run(function (env, callback) {
    callback(200, {}, "Hello world!");
});
